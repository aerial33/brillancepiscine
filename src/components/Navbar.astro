---
// Data import
import navData from "../data/navData"
import { Icon } from "astro-icon"
import {Link} from "../components/utilities"

const [contactNav] = navData.slice(-1)
const navWithoutContact = navData.filter(({ name }) => name !== "Contact")
---

<header
	class="fixed left-0 top-0 z-20 w-full border-b border-stroke/5 bg-white/30">
	<div
		class="mx-auto flex max-w-1390 flex-wrap items-center justify-between p-4 md:px-8 2xl:px-0">
		<a href="/" class="flex items-center">
			<Icon
				name="logo-color"
				class="mr-3 h-12 sm:h-18 lg:h-20"
				alt="Douceur Piscine Logo"
			/>
		</a>
		<div class="flex lg:order-2">
			<Link
				href={contactNav.path}
				text={contactNav.name}
				isFilled={true}
				classes={"font-semibold lg:py-2"}
			/>
			<button
				id="menu"
				aria-expanded="false"
				aria-label="open menu"
				class="focus:ring-gray-200 ml-3 inline-flex items-center rounded-lg p-2 text-sm text-accent focus:outline-none focus:ring-2 focus:ring-accent lg:hidden">
				<svg
					class="h-8 w-8"
					xmlns="http://www.w3.org/2000/svg"
					fill="none"
					viewBox="0 0 24 24"
					stroke="currentColor">
					<path
						stroke-linecap="round"
						stroke-linejoin="round"
						stroke-width="2"
						d="M4 6h16M4 12h16m-7 6h7"></path>
				</svg>
			</button>
		</div>
		<div
			role="menubar"
			class="hidden w-full animate-slideleft items-center justify-between lg:order-1 lg:flex lg:w-auto xl:mr-36">
			<ul
				class="mt-4 flex flex-col space-y-8 rounded-lg border border-stroke/10 bg-whiten px-8 py-8 font-medium lg:mt-0 lg:flex-row lg:space-x-8 lg:space-y-0 lg:border-0 lg:bg-transparent lg:p-0"
				>
				{
					navWithoutContact.map(navLink => (
						<li>
							{navLink.name === "Piscines" ? (
								<Link 
									href={navLink.path}	
									text={navLink.name} 
									classes={"relative group"}	
									id={"dropdown-btn"}
									icon={{name:"ph:caret-down-light", side:"right"}}
									/>
							
								<ul class="hidden animate-slidetop w-full bg-white mt-2 rounded-lg border overflow-hidden py-2  border-stroke/10 shadow lg:absolute lg:w-1/3" id="dropdown" role="listbox">

									{navLink.dropdownLinks.map(dropLink => (
									
									<li class="block px-4 py-2">
										<Link 
											href={dropLink.path}
											text={dropLink.name}
											classes={"text-body"}
										/>
									</li>
									))}
								</ul>
							) : (
								<Link
									href={navLink.path}					
									data-navlink 
									text={navLink.name}
									/>	
							)}
						</li>
					))
				}
			</ul>
		</div>
	</div>
</header>

<script>
	document.addEventListener("DOMContentLoaded", () => {
		const navBtn = document.getElementById("menu")
		const menuBar = document.querySelector('[role="menubar"]')
		const header = document.querySelector("header")
		const dropdownBtn = document.getElementById("dropdown-btn")
		const dropdown = document.querySelector('[role="listbox"]')
	
		window.addEventListener("scroll", () => {
			const isScrolled = window.pageYOffset > 20
			header.classList.toggle("backdrop-blur-lg", isScrolled)
		})
	
		navBtn.addEventListener("click", () => {
			menuBar.classList.toggle("hidden")
		})
		dropdownBtn.addEventListener("click", (e) => {
			// dropdown.classList.toggle("hidden")
			e.preventDefault();
			dropdown.classList.toggle("hidden")
			e.stopPropagation();
		})
	
		document.addEventListener("click", () => {
			dropdown.classList.add("hidden")
		})
});
</script>
